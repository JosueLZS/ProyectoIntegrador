name: CD
on:
  push:
    branches: [ main ]
jobs:
  deploy:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - name: Zip app
      run: powershell Compress-Archive -Path * -DestinationPath app.zip
    - name: Upload to S3
      uses: aws-actions/s3-sync@v2
      with:
        source: app.zip
        bucket: ${{ secrets.S3_BUCKET }}
        region: us-east-1
    - name: Deploy to EC2 via CodeDeploy
      uses: aws-actions/aws-codedeploy@v1
      with:
        application-name: MiApp
        deployment-group: MiApp-Group
        region: us-east-1
